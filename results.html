<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CC Snap Election Portal ‚Äì Results</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>

  <body>
    <div class="site-header">
      <div class="site-header-inner">
        <h1 class="site-title">CC Snap Election Portal</h1>
      </div>
    </div>

    <div class="container">
      <header>
        <h2>Results</h2>
        <p class="subtitle">Live election standings and final tally.</p>
      </header>

      <nav class="top-nav">
        <a href="/ccsnap">Guide</a>
        <a href="/ccsnap/register">Register</a>
        <a href="/ccsnap/candidates">Candidates</a>
        <a href="/ccsnap/vote">Vote</a>
        <a href="/ccsnap/results" class="active">Results</a>
      </nav>

      <div class="candidate-details-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem;">
            <h3 style="margin: 0;">Election Status</h3>
            <span id="election-status-badge" style="background: var(--surface-alt); padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem; font-weight: 600; border: 1px solid var(--border);">Loading Status...</span>
        </div>

        <!-- WINNER SECTION -->
        <div id="winner-section" class="hidden" style="margin-bottom: 2rem;">
            <div style="background-color: #f0fdf4; border-left: 4px solid #16a34a; padding: 1.5rem; border-radius: 4px;">
                <h3 id="winner-title" style="margin-top: 0; color: #166534; font-size: 1.2rem;">Current Leader</h3>
                <div style="display: flex; justify-content: space-between; align-items: baseline;">
                    <span id="winner-name" style="font-size: 1.5rem; font-weight: 700; color: #14532d;">Loading...</span>
                    <span id="winner-stats" style="font-size: 1.1rem; color: #15803d; font-weight: 600;"></span>
                </div>
            </div>
        </div>

        <!-- FULL RANKING LIST -->
        <div id="rankings-section" class="hidden" style="margin-bottom: 3rem;">
            <h4 style="margin-bottom: 1rem; color: var(--primary-dark);">Candidate Rankings</h4>
            <div class="wallet-details-container" style="margin-top: 0;">
                <table class="wallet-table results-table">
                    <thead>
                        <tr>
                            <th style="text-align: left; width: 10%;">Rank</th>
                            <th style="text-align: left;">Candidate</th>
                            <th style="text-align: right;">Total Power</th>
                            <th style="text-align: right;">Share</th>
                        </tr>
                    </thead>
                    <tbody id="rankings-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Detailed Results Table -->
        <h4 style="margin-bottom: 1rem; color: var(--text-muted);">Full Vote Log (Raw Data)</h4>
        <div id="results-placeholder" style="text-align: center; padding: 4rem 2rem; border: 2px dashed var(--border); border-radius: 12px; background-color: var(--surface-alt);">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üìä</div>
            <h4 style="color: var(--text-muted); margin: 0;">No Results Available Yet</h4>
            <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.5rem;">Real-time data visualization will appear here.</p>
        </div>

        <!-- AUDIT SECTION -->
        <div style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h4 style="margin: 0; color: var(--text-dark);">üõ°Ô∏è Independent Audit</h4>
                <span id="audit-status" class="hidden"></span>
            </div>
            <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
                Verify election integrity by checking the ledger against on-chain data, or download the full voting history to perform an independent audit yourself.
                <br><span style="font-size: 0.8rem; opacity: 0.8;">(Powered by Koios API)</span>
            </p>
            
            <div style="display: flex; gap: 1rem;">
                <button id="btn-run-audit" class="btn secondary" style="flex: 2;">Run On-Chain Audit</button>
                <button id="btn-download-ledger" class="btn secondary" style="flex: 1; border-color: var(--text-muted); color: var(--text-dark);">
                    <span style="margin-right: 0.5rem;">‚¨á</span> Download Full Voting History
                </button>
            </div>
            
            <!-- Audit Log Console -->
            <div id="audit-log" class="hidden" style="margin-top: 1rem; background: #1e293b; color: #e2e8f0; padding: 1rem; border-radius: 8px; font-family: monospace; font-size: 0.85rem; max-height: 300px; overflow-y: auto;">
            </div>
        </div>

      </div>
    </div>

    <script type="module" src="/js/app.js"></script>
  </body>
</html>